FROM golang:1.23.1-alpine

WORKDIR /app

COPY go.mod go.sum ./
RUN go mod download

COPY cmd/api/ cmd/api/
COPY internal/ internal/

WORKDIR /app/cmd/api
RUN go build -o /main

ARG API_PORT
ARG API_ENV
ARG DB_DSN
ARG JWT_SECRET
ARG DOMAIN
ARG CORS_TRUSTED_ORIGINS
ENV API_PORT=$API_PORT
ENV API_ENV=$API_ENV
ENV DB_DSN=$DB_DSN
ENV JWT_SECRET=$JWT_SECRET
ENV DOMAIN=$DOMAIN
ENV CORS_TRUSTED_ORIGINS=$CORS_TRUSTED_ORIGINS

CMD /main -port=$API_PORT -env=$API_ENV -jwt-secret=$JWT_SECRET -db-dsn=$DB_DSN -cors-trusted-origins=$CORS_TRUSTED_ORIGINS